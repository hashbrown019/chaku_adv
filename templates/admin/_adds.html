<html lang="ja">

<head>
    <title>着AD 管理ダッシュボード</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/static/css/next_styles.css" >
    <link rel="preload" as="script" fetchpriority="low" href="/static/css/%5Bturbopack%5D_browser_dev_hmr-client_hmr-client_ts_bae88007._.js">
    
    <script src="/static/js/brnLib.js"></script>
    <link rel="stylesheet" href="/static/css/x.css" >
    <link class="x-links" rel="stylesheet" href="/static/css/font-awesome.min.css">

    <meta name="next-size-adjust" content="">
    <meta name="description" content="着AD アプリケーションの管理システム">
    <meta name="generator" content="v0.app">
    <link rel="icon" href="/static/icons/icon-light-32x32.png" media="(prefers-color-scheme: light)">
    <link rel="icon" href="/static/icons/icon-dark-32x32.png" media="(prefers-color-scheme: dark)">
    <link rel="icon" href="/static/icons/icon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/static/icons/apple-icon.png">
    <link rel="preload" href="/static/fonts/797e433ab948586e-s.p.dbea232f.woff2" as="font" crossorigin="" type="font/woff2">
    <link rel="preload" href="/static/fonts/caa3a2e1cccd8315-s.p.853070df.woff2" as="font" crossorigin="" type="font/woff2">
    <style>@font-face{font-family:'__nextjs-Geist';font-style:normal;font-weight:400 600;font-display:swap;src:url(/__nextjs_font/geist-latin-ext.woff2) format('woff2');unicode-range:U+0100-02BA,U+02BD-02C5,U+02C7-02CC,U+02CE-02D7,U+02DD-02FF,U+0304,U+0308,U+0329,U+1D00-1DBF,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'__nextjs-Geist Mono';font-style:normal;font-weight:400 600;font-display:swap;src:url(/__nextjs_font/geist-mono-latin-ext.woff2) format('woff2');unicode-range:U+0100-02BA,U+02BD-02C5,U+02C7-02CC,U+02CE-02D7,U+02DD-02FF,U+0304,U+0308,U+0329,U+1D00-1DBF,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'__nextjs-Geist';font-style:normal;font-weight:400 600;font-display:swap;src:url(/__nextjs_font/geist-latin.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'__nextjs-Geist Mono';font-style:normal;font-weight:400 600;font-display:swap;src:url(/__nextjs_font/geist-mono-latin.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style>
    
</head>

<body class="font-sans antialiased" style="">
    <div hidden=""></div>
    <div class="flex h-screen bg-muted/20">
        {% include '__sidepanel.html' %}
        
        <main class="flex-1 overflow-auto">
            <div class="container mx-auto p-8">
                <!--$-->
                <!--/$-->
                <div class="space-y-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <h1 class="text-3xl font-bold text-foreground">広告管理</h1>
                            <p class="mt-2 text-muted-foreground">広告コンテンツの作成と管理</p>
                        </div><a href="/new_ads"></a>
                    </div>
                    <div data-slot="card" class="bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm">
                        <div data-slot="card-header" class="@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-2 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6">
                            <div data-slot="card-title" class="leading-none font-semibold text-foreground">広告一覧</div>
                        </div>
                        <div data-slot="card-content" class="px-6">
                            <div data-slot="table-container" class="relative w-full overflow-x-auto">

                               
                                <table data-slot="table" class="w-full caption-bottom text-sm">
                                    <thead data-slot="table-header" class="[&amp;_tr]:border-b">
                                        <tr data-slot="table-row" class="hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors">
                                        	<th></th>
                                            <th data-slot="table-head" class="text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&amp;:has([role=checkbox])]:pr-0 [&amp;&gt;[role=checkbox]]:translate-y-[2px]">
                                                <font dir="auto" style="vertical-align: inherit;">
                                                    <font dir="auto" style="vertical-align: inherit;">タイトル/広告ID</font>
                                                </font>
                                            </th>
                                            <th data-slot="table-head" class="text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&amp;:has([role=checkbox])]:pr-0 [&amp;&gt;[role=checkbox]]:translate-y-[2px]">
                                                <font dir="auto" style="vertical-align: inherit;">
                                                    <font dir="auto" style="vertical-align: inherit;">広告主</font>
                                                </font>
                                            </th>
                                            <th data-slot="table-head" class="text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&amp;:has([role=checkbox])]:pr-0 [&amp;&gt;[role=checkbox]]:translate-y-[2px]">
                                                <font dir="auto" style="vertical-align: inherit;">
                                                    <font dir="auto" style="vertical-align: inherit;">説明</font>
                                                </font>
                                            </th>
                                            <th data-slot="table-head" class="text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&amp;:has([role=checkbox])]:pr-0 [&amp;&gt;[role=checkbox]]:translate-y-[2px]">
                                                <font dir="auto" style="vertical-align: inherit;">
                                                    <font dir="auto" style="vertical-align: inherit;">配布範囲</font>
                                                </font>
                                            </th>
                                            <th data-slot="table-head" class="text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&amp;:has([role=checkbox])]:pr-0 [&amp;&gt;[role=checkbox]]:translate-y-[2px]">
                                                <font dir="auto" style="vertical-align: inherit;">
                                                    <font dir="auto" style="vertical-align: inherit;">タイプ</font>
                                                </font>
                                            </th>
                                            <th data-slot="table-head" class="text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&amp;:has([role=checkbox])]:pr-0 [&amp;&gt;[role=checkbox]]:translate-y-[2px]">
                                                <font dir="auto" style="vertical-align: inherit;">
                                                    <font dir="auto" style="vertical-align: inherit;">アップロード日</font>
                                                </font>
                                            </th>
                                            <th data-slot="table-head" class="text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&amp;:has([role=checkbox])]:pr-0 [&amp;&gt;[role=checkbox]]:translate-y-[2px]">
                                                <font dir="auto" style="vertical-align: inherit;">
                                                    <font dir="auto" style="vertical-align: inherit;">広告ステータス</font>
                                                </font>
                                            </th>
                                            <th data-slot="table-head" class="text-foreground h-10 px-2 align-middle font-medium whitespace-nowrap [&amp;:has([role=checkbox])]:pr-0 [&amp;&gt;[role=checkbox]]:translate-y-[2px] text-right">
                                                <font dir="auto" style="vertical-align: inherit;">
                                                    <font dir="auto" style="vertical-align: inherit;">手術</font>
                                                </font>
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody data-slot="table-body" class="[&amp;_tr:last-child]:border-0">
                                        {% for ad_id in ads %}
                                        {% set ad = ads[ad_id] %}
										{% set _path = ad['storagePath'] %}

                                        <tr data-slot="table-row" class="x-hover-pale-blue">
                                            <td data-slot="table-cell" class="p-2 align-middle whitespace-nowrap [&amp;:has([role=checkbox])]:pr-0 [&amp;&gt;[role=checkbox]]:translate-y-[2px] font-mono text-sm">
                                                <a href="#" onclick="open_dialog('/view_ads_file?file_path={{_path}}')">
                                                    <span class="fa fa-play-circle x-text-blue x-xlarge" title="View ads"></span>
                                                </a>
                                            </td>
                                            <td data-slot="table-cell" class="p-2 align-middle whitespace-nowrap [&amp;:has([role=checkbox])]:pr-0 [&amp;&gt;[role=checkbox]]:translate-y-[2px] font-mono text-sm">
                                                <font dir="auto" style="vertical-align: inherit;">
                                                    <font class="x-small" dir="auto" style="vertical-align: inherit;">
                                                        <b>{{ad['title']}}</b>
                                                    </font><br>
                                                    <i class="x-tiny x-text-grey">{{ad_id}}</i>
                                                </font>
                                            </td>
                                            <td data-slot="table-cell" class="p-2 align-middle whitespace-nowrap [&amp;:has([role=checkbox])]:pr-0 [&amp;&gt;[role=checkbox]]:translate-y-[2px]">
                                                <div class="flex items-center gap-2">
                                                    <span>
                                                        <font dir="auto" style="vertical-align: inherit;">
                                                            <font dir="auto" style="vertical-align: inherit;">
                                                                {% if ad['advertiserId'] in advertisers %}
                                                                    {{advertisers[ad['advertiserId']]['name']}}<br>
                                                                    <span class="x-tiny x-text-grey"> 
                                                                        {{advertisers[ad['advertiserId']]['email']}}
                                                                    </span><br>
                                                                    <span class="x-tiny x-text-grey"> 
                                                                        {{advertisers[ad['advertiserId']]['manager']}}
                                                                    </span><br>
                                                                {% else %}
                                                                    <span class="x-small x-text-grey">
                                                                        advertiser removed or not found
                                                                    </span>
                                                                {% endif %}
                                                            </font>
                                                        </font>
                                                    </span></div>
                                            </td>
                                            <td data-slot="table-cell" class="p-2 align-middle whitespace-nowrap [&amp;:has([role=checkbox])]:pr-0 [&amp;&gt;[role=checkbox]]:translate-y-[2px]">
                                                <div class="flex items-center gap-2"><span>
                                                    <font dir="auto" style="vertical-align: inherit;">
                                                        <font dir="auto" style="vertical-align: inherit;">{{ad['description']}}</font>
                                                    </font>
                                                </span></div>
                                            </td>
                                            <td data-slot="table-cell" class="p-2 align-middle whitespace-nowrap [&amp;:has([role=checkbox])]:pr-0 [&amp;&gt;[role=checkbox]]:translate-y-[2px]">
                                                <font dir="auto" style="vertical-align: inherit;">
                                                    <font dir="auto" style="vertical-align: inherit;">{{ad['radiusMeters']}}</font>
                                                </font>
                                                <font dir="auto" style="vertical-align: inherit;">
                                                    <font dir="auto" style="vertical-align: inherit;">meters</font>
                                                </font>
                                            </td>
                                            <td data-slot="table-cell" class="p-2 align-middle whitespace-nowrap [&amp;:has([role=checkbox])]:pr-0 [&amp;&gt;[role=checkbox]]:translate-y-[2px]">
                                                <font dir="auto" style="vertical-align: inherit;">
                                                    <font dir="auto" style="vertical-align: inherit;">{{ad['type']}}</font>
                                                </font>
                                            </td>
                                            <td data-slot="table-cell" class="p-2 align-middle whitespace-nowrap [&amp;:has([role=checkbox])]:pr-0 [&amp;&gt;[role=checkbox]]:translate-y-[2px]">
                                                <font dir="auto" style="vertical-align: inherit;">
                                                    <font dir="auto" style="vertical-align: inherit;">
                                                        {% set end_date = ad['createdAt']|string %}
                                                        {{end_date.split(" ")[0]}}
                                                    </font>
                                                </font>
                                            </td>
                                            <td data-slot="table-cell" class="p-2 align-middle whitespace-nowrap [&amp;:has([role=checkbox])]:pr-0 [&amp;&gt;[role=checkbox]]:translate-y-[2px]">

												{%if ad['status'] in ['rejected','suspended']%}
													{% set color = "red"%}
												{%elif ad['status'] in ['under_review','refund_processing']%}
													{% set color = "yellow"%}
												{%elif ad['status'] in ['published','refunded']%}
													{% set color = "green"%}
												{% else %}
													{% set color = "grey"%}
												{%endif%}
                                                <select id="ads_stat_{{ad_id}}" class="x-text-{{color}} x-select x-round-large" onchange="set_stat_ads('{{ad_id}}',this.value)">
													<option value="draft" disabled selected>下書き</option>
													<option value="under_review" class="x-text-yellow">審査中</option>
													<option value="published" class="x-text-green">公開済み</option>
													<option value="rejected" class="x-text-red">却下</option>
													<option value="refund_processing" class="x-text-yellow">返金処理中</option>
													<option value="refunded" class="x-text-green">返金済み</option>
													<option value="suspended" class="x-text-red">停止中</option>

                                                </select>
                                                <script>
                                                    $onload(function(){
                                                        $ID('ads_stat_{{ad_id}}').value = "{{ad['status']}}"
                                                    })
                                                </script>
                                                <span class="row"><br>{{ad['admin_note']}}</span>
                                            </td>
                                            <td data-slot="table-cell" class="p-2 align-middle whitespace-nowrap [&amp;:has([role=checkbox])]:pr-0 [&amp;&gt;[role=checkbox]]:translate-y-[2px] text-right">
                                                
                                                <a href="/rmads_admin/{{ad_id}}">
                                                    <span class="fa fa-trash x-text-red x-xlarge" title="Delete"></span>
                                                </a>
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

	<!-- The Modal -->
	<div id="dialog_reason" class="x-modal" style="" onclick="close_player()">
        <div class="x-modal-content x-round-large" style="max-width:50%;">
            <div class="x-container x-padding">
                この広告が停止／ブロックされた理由を入力してください
                <div>
                    <textarea id="note" class="x-input x-textarea x-border" 
                        placeholder="この広告が停止／ブロックされた理由の簡単な説明" 
                        style="height: 40vh;"></textarea>
                </div>
                <div class="x-container x-center x-padding-top"><br>
                    <button class="x-button x-round-large x-border x-border-red x-text-red" 
                        onclick="$ID('dialog_reason').style.display='none'">
                        キャンセル
                    </button>
                    <button class="x-button x-round-large x-blue" onclick="submitnote()">
                        理由を送信
                    </button>
                </div>
            </div>
            <span class="x-tiny x-text-grey">
                広告ID: <b id='ad_id'></b> | アクション: <b id="val"></b>
            </span>
    	</div>
    </div>
	<!-- The Modal -->
	<div id="id01" class="x-modal" style="background-color: rgba(, 0, 0, 0.5)" onclick="close_player()">
		<div class="x-modal-content x-round-large" style="max-width:50%;background-color: rgba(, 0, 0, 0.5)">
			<div class="ad_container">
			  <video id="ad_preview"
			         autoplay
			         controls
			         preload="none"
			         poster="loading_data.gif"
			         class="ad_video">
			  </video>
			</div>
			<style>
				.ad_container {
					display: flex;
					justify-content: center;  /* horizontal */
					align-items: center;      /* vertical */
					}

				.ad_video {
					max-width: 100%; 
					width: 100%;         /* Video takes full width of container */
					height: auto;        /* Keeps aspect ratio */
					display: block;
				}

			</style>

		</div>
	</div>
	<script>
		// $ID('dialog_reason').style.display="block";
		function open_dialog(_path,ad_id){
			document.getElementById('id01').style.display='block'
			$ID('ad_preview').src = _path
			
		}

		function close_player(){
			document.getElementById('id01').style.display='none'
			$ID('ad_preview').pause();
			$ID('ad_preview').currentTime = 0;
		}

		function submitnote(){
			var aid =$ID('ad_id').innerText
			var val = $ID('val').innerText
			var note = $ID('note').value
			_set_stat_ads(aid,val,note)
		}

        function set_stat_ads(aid,val){
        	if(['rejected','suspended'].indexOf(val) !== -1){
        		$ID('dialog_reason').style.display="block"
        		$ID('ad_id').innerText = aid
        		$ID('val').innerText = val
        	}else{
        		_set_stat_ads(aid,val,"")
        	}
        }
        function _set_stat_ads(aid,val,note){
        	$send({
                action : '/set_stat_ads/'+aid +'/'+val+'?note='+note,
                method : GET,
                func : function(r){
                    goto(r)
                }
            })
        }

    </script>
</body>

</html>